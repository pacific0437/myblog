
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ashley&#8217;s Blog</title>
  <meta name="author" content="Ashley Yang">

  
  <meta name="description" content="Redux 三大原则 单一数据源。 整个应用的 state 被储存在一棵 object tree 中，它只有一个单一的 store 。
State 是只读的。 惟一改变 state 的办法就是触发 action，action 是一个描述要发生什么的对象。
纯函数的形式来执行修改。 为了描述 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pacific0437.github.io/myblog">
  <link href="/myblog/favicon.png" rel="icon">
  <link href="/myblog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/myblog/atom.xml" rel="alternate" title="Ashley's Blog" type="application/atom+xml">
  <script src="/myblog/javascripts/modernizr-2.0.js"></script>
  <script src="/myblog/javascripts/libs/jquery.min.js"></script>
  <script src="/myblog/javascripts/octopress.js" type="text/javascript"></script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/myblog/">Ashley&#8217;s Blog</a></h1>
  
    <h2>A blogging framework for Ashley.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/myblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pacific0437.github.io/myblog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/myblog/">Blog</a></li>
  <li><a href="/myblog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/redux/">Redux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-11T21:04:32+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Redux 三大原则</h3>

<ul>
<li>单一数据源。 整个应用的 state 被储存在一棵 object tree 中，它只有一个单一的 store 。</li>
<li>State 是只读的。 惟一改变 state 的办法就是触发 action，action 是一个描述要发生什么的对象。</li>
<li>纯函数的形式来执行修改。 为了描述 action 如何改变 state tree ，你需要编写 reducers。</li>
</ul>


<h3>同 Flux 的关系</h3>

<p>Redux 没有 dispatcher 的概念，它依赖纯函数来替代事件处理器。Redux 设想你永远不会变动你的数据。
细节有所不同：分别体现在 reducer 和 state 上。</p>

<h3>Action</h3>

<p>Actions 是把数据从应用传到 store 的有效载荷。它是 store 数据的惟一来源。
Actions 表明有事情发生了，包含了更新 state 所需要的足够多的信息。
Action 本质是 JavaScript 普通对象。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>      type: 'ADD_TODO',
</span><span class='line'>      text: 'Build my first Redux app'
</span><span class='line'>}
</span><span class='line'>{
</span><span class='line'>    type: 'DELETE_TODO',
</span><span class='line'>    index: 5
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Action 创建函数</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function addTodo(text) {
</span><span class='line'>  return {
</span><span class='line'>     type: ADD_TODO,
</span><span class='line'>     text
</span><span class='line'>   };
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Reducer</h3>

<p>reducer 就是一个函数，接收旧的 state 和 action，返回新的 state。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(previousState, action) =&gt; newState</span></code></pre></td></tr></table></div></figure>


<p>不要修改 state。</p>

<p>在 default 情况下返回旧的 state。遇到未知的 action 时，一定要返回旧的 state。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  visibilityFilter: 'SHOW_ALL',
</span><span class='line'>  todos: [{
</span><span class='line'>    text: 'Consider using Redux',
</span><span class='line'>    completed: true,
</span><span class='line'>  }, {
</span><span class='line'>    text: 'Keep all state in a single tree',
</span><span class='line'>    completed: false
</span><span class='line'>  }]
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function todoApp(state = initialState, action) {
</span><span class='line'>  switch (action.type) {
</span><span class='line'>  case SET_VISIBILITY_FILTER:
</span><span class='line'>    return Object.assign({}, state, {
</span><span class='line'>      visibilityFilter: action.filter
</span><span class='line'>    });
</span><span class='line'>  case ADD_TODO:
</span><span class='line'>    return Object.assign({}, state, {
</span><span class='line'>      todos: [...state.todos, {
</span><span class='line'>        text: action.text,
</span><span class='line'>        completed: false
</span><span class='line'>      }]
</span><span class='line'>    });
</span><span class='line'>  case COMPLETE_TODO:
</span><span class='line'>    return Object.assign({}, state, {
</span><span class='line'>      todos: [
</span><span class='line'>        ...state.todos.slice(0, action.index),
</span><span class='line'>        Object.assign({}, state.todos[action.index], {
</span><span class='line'>          completed: true
</span><span class='line'>        }),
</span><span class='line'>        ...state.todos.slice(action.index + 1)
</span><span class='line'>      ]
</span><span class='line'>    });
</span><span class='line'>  default:
</span><span class='line'>    return state;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>combineReducers</p>

<p>一个函数来做为主 reducer，它调用多个子 reducer 分别处理 state 中的一部分数据，然后再把这些数据合成一个大的单一对象。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>function todoApp(state = {}, action) {
</span><span class='line'>  return {
</span><span class='line'>    visibilityFilter: visibilityFilter(state.visibilityFilter, action),
</span><span class='line'>    todos: todos(state.todos, action)
</span><span class='line'>  };
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function todos(state = [], action) {
</span><span class='line'>  switch (action.type) {
</span><span class='line'>  case ADD_TODO:
</span><span class='line'>    return [...state, {
</span><span class='line'>      text: action.text,
</span><span class='line'>      completed: false
</span><span class='line'>    }];
</span><span class='line'>  case COMPLETE_TODO:
</span><span class='line'>    return [
</span><span class='line'>      ...state.slice(0, action.index),
</span><span class='line'>      Object.assign({}, state[action.index], {
</span><span class='line'>        completed: true
</span><span class='line'>      }),
</span><span class='line'>      ...state.slice(action.index + 1)    
</span><span class='line'>    ];
</span><span class='line'>  default:
</span><span class='line'>    return state;
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function visibilityFilter(state = SHOW_ALL, action) {
</span><span class='line'>  switch (action.type) {
</span><span class='line'>  case SET_VISIBILITY_FILTER:
</span><span class='line'>    return action.filter;
</span><span class='line'>  default:
</span><span class='line'>    return state;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>最后，Redux 提供了 combineReducers() 工具类来做上面 todoApp 做的事情，这样就能消灭一些样板代码了</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import { combineReducers } from 'redux';
</span><span class='line'>
</span><span class='line'>const todoApp = combineReducers({
</span><span class='line'>  visibilityFilter,
</span><span class='line'>  todos
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>export default todoApp;</span></code></pre></td></tr></table></div></figure>


<h3>Store</h3>

<p>Store 就是把action and reducers联系到一起的对象。
Store 有以下职责：</p>

<ul>
<li>维持应用的 state；</li>
<li>提供 getState() 方法获取 state；</li>
<li>提供 dispatch(action) 方法更新 state；</li>
<li>通过 subscribe(listener) 注册监听器。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import { createStore } from 'redux';
</span><span class='line'>import todoApp from './reducers';
</span><span class='line'>
</span><span class='line'>let store = createStore(todoApp);
</span><span class='line'>
</span><span class='line'>let unsubscribe = store.subscribe(() =&gt;
</span><span class='line'>  console.log(store.getState())
</span><span class='line'>);
</span><span class='line'>
</span><span class='line'>// 发起一系列 action
</span><span class='line'>store.dispatch(addTodo('Learn about actions'));
</span><span class='line'>store.dispatch(addTodo('Learn about reducers'));
</span><span class='line'>store.dispatch(addTodo('Learn about store'));
</span><span class='line'>store.dispatch(completeTodo(0));
</span><span class='line'>store.dispatch(completeTodo(1));
</span><span class='line'>store.dispatch(setVisibilityFilter(VisibilityFilters.SHOW_COMPLETED));
</span><span class='line'>
</span><span class='line'>// 停止监听 state 更新
</span><span class='line'>unsubscribe();</span></code></pre></td></tr></table></div></figure>


<h3>数据流</h3>

<p><img src="/myblog/images/image/Redux.png" alt="" /></p>

<ul>
<li>调用 store.dispatch(action)。</li>
<li>Redux store 调用传入的 reducer 函数。</li>
<li>根 reducer 应该把多个子 reducer 输出合并成一个单一的 state 树。</li>
<li>Redux store 保存了根 reducer 返回的完整 state 树。</li>
</ul>


<h3>With React</h3>

<p>Redux 和 React 之间没有关系。Redux 支持 React、Angular、Ember、jQuery 甚至纯 JavaScript。
Redux 还是和 React 和 Deku 这类框架搭配起来用最好，因为这类框架允许你以 state 函数的形式来描述界面，Redux 通过 action 的形式来发起 state 变化。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm install --save react-redux</span></code></pre></td></tr></table></div></figure>


<p>只在最顶层组件里使用 Redux。</p>

<p>内部组件应该像木偶一样保持“呆滞”，所有数据都通过 props 传入。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import React from 'react'
</span><span class='line'>import { render } from 'react-dom'
</span><span class='line'>import { createStore } from 'redux'
</span><span class='line'>import { Provider } from 'react-redux'
</span><span class='line'>import App from './containers/App'
</span><span class='line'>import todoApp from './reducers'
</span><span class='line'>
</span><span class='line'>let store = createStore(todoApp)
</span><span class='line'>
</span><span class='line'>let rootElement = document.getElementById('root')
</span><span class='line'>render(
</span><span class='line'>  &lt;Provider store={store}&gt;
</span><span class='line'>    &lt;App /&gt;
</span><span class='line'>  &lt;/Provider&gt;,
</span><span class='line'>  rootElement
</span><span class='line'>)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class App extends Component {
</span><span class='line'>  render() {
</span><span class='line'>    // Injected by connect() call:
</span><span class='line'>    const { dispatch, visibleTodos, visibilityFilter } = this.props;
</span><span class='line'>    return (
</span><span class='line'>      &lt;div&gt;
</span><span class='line'>        &lt;AddTodo
</span><span class='line'>          onAddClick={text =&gt;
</span><span class='line'>            dispatch(addTodo(text))
</span><span class='line'>          } /&gt;
</span><span class='line'>        &lt;TodoList
</span><span class='line'>          todos={this.props.visibleTodos}
</span><span class='line'>          onTodoClick={index =&gt;
</span><span class='line'>            dispatch(completeTodo(index))
</span><span class='line'>          } /&gt;
</span><span class='line'>        &lt;Footer
</span><span class='line'>          filter={visibilityFilter}
</span><span class='line'>          onFilterChange={nextFilter =&gt;
</span><span class='line'>            dispatch(setVisibilityFilter(nextFilter))
</span><span class='line'>          } /&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    );
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// Which props do we want to inject, given the global state?
</span><span class='line'>function select(state) {
</span><span class='line'>  return {
</span><span class='line'>    visibleTodos: selectTodos(state.todos, state.visibilityFilter),
</span><span class='line'>    visibilityFilter: state.visibilityFilter
</span><span class='line'>  };
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// Wrap the component to inject dispatch and state into it
</span><span class='line'>export default connect(select)(App);</span></code></pre></td></tr></table></div></figure>


<h3>异步action 及 middleware</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>                                                                                  ┌──────────────┐
</span><span class='line'>                    ┌─────────────┐                                           ┌──▶│ subReducer 1 │
</span><span class='line'>               ┌───▶│Middleware 1 │                                           │   └──────────────┘
</span><span class='line'>               │    └─────────────┘                                           │           │       
</span><span class='line'>               │           │                                                  │           ▼       
</span><span class='line'>┌─────────────┐    │           │              ┌───────────────┐    ┌──────────┐   │   ┌──────────────┐
</span><span class='line'>│   action'   │────┘           ▼          ┌──▶│store.dispatch │───▶│ reducer  │───┘   │ subReducer m │
</span><span class='line'>└─────────────┘         ┌─────────────┐   │   └───────────────┘    └──────────┘       └──────────────┘
</span><span class='line'>                    │Middleware n │   │                                                   │       
</span><span class='line'>                    └─────────────┘   │                                                   │       
</span><span class='line'>                           │          │                                                   ▼       
</span><span class='line'>                           │          │                                           ┌──────────────┐
</span><span class='line'>                           └──────────┘                                           │    state     │
</span><span class='line'>                           plain action                                           └──────────────┘</span></code></pre></td></tr></table></div></figure>


<p>通过使用指定的 middleware，action creator 除了返回 action 对象外还可以返回函数。这时，这个 action creator 就成为了 thunk。</p>

<p>当 action creator 返回函数时，这个函数会被 Redux Thunk middleware 执行。这个函数并不需要保持纯净；它还可以带有副作用，包括执行异步 API 请求。这个函数还可以 dispatch action，就像 dispatch 前面定义的同步 action 一样。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import thunkMiddleware from 'redux-thunk';
</span><span class='line'>import createLogger from 'redux-logger';
</span><span class='line'>import { createStore, applyMiddleware } from 'redux';
</span><span class='line'>import { selectReddit, fetchPosts } from './actions';
</span><span class='line'>import rootReducer from './reducers';
</span><span class='line'>
</span><span class='line'>const loggerMiddleware = createLogger();
</span><span class='line'>
</span><span class='line'>const createStoreWithMiddleware = applyMiddleware(
</span><span class='line'>  thunkMiddleware, // 允许我们 dispatch() 函数
</span><span class='line'>  loggerMiddleware // 一个很便捷的 middleware，用来打印 action 日志
</span><span class='line'>)(createStore);
</span><span class='line'>
</span><span class='line'>const store = createStoreWithMiddleware(rootReducer);
</span><span class='line'>
</span><span class='line'>store.dispatch(selectReddit('reactjs'));
</span><span class='line'>store.dispatch(fetchPosts('reactjs')).then(() =&gt;
</span><span class='line'>  console.log(store.getState())
</span><span class='line'>);</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export function fetchPosts(reddit) {
</span><span class='line'>
</span><span class='line'>  // Thunk middleware 知道如何处理函数。
</span><span class='line'>  // 这里把 dispatch 方法通过参数的形式参给函数，
</span><span class='line'>  // 以此来让它自己也能 dispatch action。
</span><span class='line'>
</span><span class='line'>  return function (dispatch) {
</span><span class='line'>
</span><span class='line'>    // 首次 dispatch：更新应用的 state 来通知
</span><span class='line'>    // API 请求发起了。
</span><span class='line'>
</span><span class='line'>    dispatch(requestPosts(reddit));
</span><span class='line'>
</span><span class='line'>    // thunk middleware 调用的函数可以有返回值，
</span><span class='line'>    // 它会被当作 dispatch 方法的返回值传递。
</span><span class='line'>
</span><span class='line'>    // 这个案例中，我们返回一个等待处理的 promise。
</span><span class='line'>    // 这并不是 redux middleware 所必须的，但是我们的一个约定。
</span><span class='line'>
</span><span class='line'>    return fetch(`http://www.reddit.com/r/${reddit}.json`)
</span><span class='line'>      .then(response =&gt; response.json())
</span><span class='line'>      .then(json =&gt;
</span><span class='line'>
</span><span class='line'>        // 可以多次 dispatch！
</span><span class='line'>        // 这里，使用 API 请求结果来更新应用的 state。
</span><span class='line'>
</span><span class='line'>        dispatch(receivePosts(reddit, json))
</span><span class='line'>      );
</span><span class='line'>
</span><span class='line'>      // 在实际应用中，还需要
</span><span class='line'>      // 捕获网络请求的异常。
</span><span class='line'>  };
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>redux-thunk 支持异步的 middleware 包装了 store 的 dispatch() 方法，以此来让你 dispatch 一些除了 action 以外的其他内容，如函数。你所使用的任何 middleware 都可以以自己的方式解释你 dispatch 的任何内容，并继续传递 actions 给下一个 middleware。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function thunkMiddleware(_ref) {
</span><span class='line'>  var dispatch = _ref.dispatch;
</span><span class='line'>  var getState = _ref.getState;
</span><span class='line'>
</span><span class='line'>  return function (next) {
</span><span class='line'>    return function (action) {
</span><span class='line'>      return typeof action === 'function' ? action(dispatch, getState) : next(action);
</span><span class='line'>    };
</span><span class='line'>  };
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/web-socket/">Web Socket</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-14T14:47:19+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:47 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Client</h2>

<pre><code>var a = new WebSocket("ws://localhost:8080/abcd");
a.onmessage = function(event){
    var data = event.data;
    console.log(event);
    console.log(data);
};
a.onopen = function(){
    console.log('open');
}
a.onclose = function(){
    console.log('close');
}
//a.send("data");
//a.close();
</code></pre>

<h2>Server</h2>

<p>Use <a href="https://github.com/websockets/ws">WS</a></p>

<p>I didn&rsquo;t use Socket.io</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var WebSocketServer = require('ws').Server
</span><span class='line'>wss = new WebSocketServer({ port: 8080, path:'/abcd' });
</span><span class='line'>
</span><span class='line'>wss.on('connection', function connection(ws) {
</span><span class='line'>  ws.on('message', function incoming(message) {
</span><span class='line'>console.log('received: %s', message);
</span><span class='line'>ws.send('I received' + message + 'is that you sended?')
</span><span class='line'>ws.send('connection will close in 8s');
</span><span class='line'>setTimeout(function(){ws.close()},8000)
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  ws.send('connection works fine');
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/web-component/">Web Components</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-13T09:37:34+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:37 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h5>HTML Templates</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;template id="radiogroup"&gt;
</span><span class='line'>  &lt;input type="radio" name=""&gt; &lt;label&gt;&lt;/label&gt;
</span><span class='line'>  &lt;input type="radio" name=""&gt; &lt;label&gt;&lt;/label&gt;
</span><span class='line'>  &lt;style&gt;
</span><span class='line'>  label{
</span><span class='line'>    color:red;
</span><span class='line'>    }
</span><span class='line'>  &lt;/style&gt;
</span><span class='line'>&lt;/template&gt;</span></code></pre></td></tr></table></div></figure>


<h5>Custom Elements and Shadow DOM</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var template = document.querySelector('#radiogroup');
</span><span class='line'>var appInfoProto = Object.create(HTMLElement.prototype);
</span><span class='line'>appInfoProto.createdCallback = function() {
</span><span class='line'>    var root = this.createShadowRoot();
</span><span class='line'>    // template.content
</span><span class='line'>    var clone = template.content.cloneNode(true);
</span><span class='line'>    var myInputNodeList = clone.querySelectorAll('input');
</span><span class='line'>    for (var i = 0; i &lt; myInputNodeList.length; ++i) {
</span><span class='line'>      var item = myInputNodeList.item(i);
</span><span class='line'>      item.setAttribute('id',this.getAttribute('data'+i));
</span><span class='line'>      item.setAttribute('name',this.getAttribute('name'));
</span><span class='line'>    }
</span><span class='line'>    var myLabelNodeList = clone.querySelectorAll('label');
</span><span class='line'>    for (var i = 0; i &lt; myLabelNodeList.length; ++i) {
</span><span class='line'>      var item = myLabelNodeList.item(i);
</span><span class='line'>      item.setAttribute('for',this.getAttribute('data'+i));
</span><span class='line'>      item.innerHTML = this.getAttribute('message'+i)
</span><span class='line'>    }
</span><span class='line'>    root.appendChild(clone);
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>document.registerElement('my-radiogroup', {
</span><span class='line'>    prototype: appInfoProto
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<h5>Use Custom Question in your HTML</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;my-radiogroup id="group" data0="id0" message0="player0" data1="id1" message1="player1" name="basketball"&gt;&lt;/my-radiogroup&gt;
</span><span class='line'>&lt;label for=""&gt; I am innocence&lt;/label&gt;
</span><span class='line'>&lt;my-radiogroup id="group" data0="leon" message0="Messi" data1="me" message1="Ashley" name="football"&gt;&lt;/my-radiogroup&gt;
</span><span class='line'>
</span><span class='line'>&lt;my-radiogroup id="group" data0="A" message0="A" data1="B" message1="B" data2="C" message2="C" data3="D" message3="D"name="Charctor"&gt;&lt;/my-radiogroup&gt;</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/css-grid-layout1/">Talk About Git</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-09T15:55:16+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:55 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>学习 Git 的第一条规则就是，你不能谈及自己在学习 Git1。因为这个工具由 Linus Torvalds 主导的 Linux 内核社区设计开发，并且由最酷最炫的 GitHub 发扬光大，从头到脚围绕着高大上的光环，全世界聪明的程序员都会用（至少声称自己会用）它来管理自己的代码。如果你在跟人聊天时不经意透露了自己「正在学习使用 Git」，无疑所有人都会投来高贵冷艳充满优越感的目光，并且告诉你：「连我们的设计师都会用 Git 管理他的 PSD 了，你竟然才在学怎么用？」所以，永远不要谈及自己在学习它——是的，你已经熟练地掌握了使用 Git 的所有要领。</p>

<p>学习 Git 的第二条规则是，你不能觉得它概念难懂，命令太多。因为全世界聪明的程序员都在公共场合大谈自己是如何在行驶的飞机上单枪匹马搞定分支合并的冲突，并且一下飞机就风驰电掣地连上机场 Wi-Fi，成功 push 了代码，发起了 pull request。所以，你一定要在心里默念，我是全世界聪明的程序员之一，Git 这点东西显然不在我的话下，少焉，流淌于键盘之上，玩转于股掌之间2。</p>

<p>From <a href="http://mweb.baidu.com/p/git-101.html">git101</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/some-standard-events/">Some Standard Events</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-15T14:00:04+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:00 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>blur</h2>

<p>FocusEvent<br/>
DOM  L3<br/>
An element has lost focus (does not bubble).</p>

<h2>change</h2>

<p>Event <br/>
DOM L2, HTML5 <br/>
An element loses focus and its value changed since gaining focus.</p>

<h2>click</h2>

<p>MouseEvent<br/>
DOM L3<br/>
A pointing device button has been pressed and released on an element.</p>

<h2>input</h2>

<p>Event <br/>
HTML5 <br/>
The value of an element changes or the content of an element with the attribute contenteditable is modified.
IE9 support</p>

<h2>select</h2>

<p>UIEvent
DOM L3<br/>
Some text is being selected.</p>

<p><strong>No business with input select element</strong></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/do-not-change-backbone-objects-cid/">Do Not Change Backbone Object&#8217;s Cid</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-08T15:24:15+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:24 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yesterday when I debugged some old JS code, I found an interesting thing that some event&rsquo;s callback function ran two times.</p>

<h4>1 JQuery Event</h4>

<p>on</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jQuery.fn.extend({
</span><span class='line'>
</span><span class='line'>  on: function( types, selector, data, fn, /*INTERNAL*/ one ) {
</span><span class='line'>          ...... //ignore some code
</span><span class='line'>          jQuery.event.add( this, types, fn, data, selector )
</span><span class='line'>      }
</span><span class='line'>  })</span></code></pre></td></tr></table></div></figure>


<p>add</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>add: function( elem, types, handler, data, selector ) {
</span><span class='line'>      elemData = data_priv.get( elem );//get the cache of the element
</span><span class='line'>      eventHandle = elemData.handle = function( e ) {
</span><span class='line'>          jQuery.event.dispatch.apply( elem, arguments )
</span><span class='line'>      }
</span><span class='line'>      elem.addEventListener( type, eventHandle, false );//when event trigger, always run eventHandle/dispatch, do not run handler directly
</span><span class='line'>      elemData.events[ type ] = jQuery.extend({
</span><span class='line'>          type: type,
</span><span class='line'>          origType: origType,
</span><span class='line'>          data: data,
</span><span class='line'>          handler: handler,
</span><span class='line'>          guid: handler.guid,
</span><span class='line'>          selector: selector,
</span><span class='line'>          needsContext: selector && jQuery.expr.match.needsContext.test( selector ),
</span><span class='line'>          namespace: namespaces.join(".")
</span><span class='line'>      }, handleObjIn ); //the true callback stored in the cache, and it must be runned by the dispatch function 
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p>dispatch</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch: function( event ) {
</span><span class='line'>  // Make a writable jQuery.Event from the native event object
</span><span class='line'>  event = jQuery.event.fix( event );
</span><span class='line'>  handlers = ( data_priv.get( this, "events" ) || {} )[ event.type ] ;//find the right type event from the cache
</span><span class='line'>  // Determine handlers
</span><span class='line'>  handlerQueue = jQuery.event.handlers.call( this, event, handlers );
</span><span class='line'>  handleObj.handler.apply( matched.elem, args );
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<h4>2 Backbone Event delegate</h4>

<p><img src="/myblog/images/image/backbone-events.png" alt="" /></p>

<p>we can see that backbone change the origin event name that we write in events like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>events:{
</span><span class='line'>  'click #saveButton1': 'saveForm',
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>3 The truth</h4>

<p>someone change the view&rsquo;s cid privately after initialize:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>this.cid = model.cid;</span></code></pre></td></tr></table></div></figure>


<p>So when the view delegate Events, the undelegateEvents doesn&rsquo;t work as purposes.
The events who have the old event name could not be found and be off.
after delegate, some events have a copy of themselves.</p>

<p><img src="/myblog/images/image/backbone-events1.png" alt="" /></p>

<p>Thus, they run two times.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/css-grid-layout/">CSS Grid Layout</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-25T20:48:33+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>CSS Grid Layout</h2>

<p>Two-dimensional grid-based layout system aligns elements into columns and rows.</p>

<h3>Basic definition</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.wrapper {
</span><span class='line'>  display: grid;
</span><span class='line'>  grid-template-columns: 100px 60px 100px 60px 100px;
</span><span class='line'>  grid-template-rows: 50px 70px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.b, .d, .f, .h, .j {
</span><span class='line'>  background-color: red;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><img src="/myblog/images/image/QQ20150318-2.png" alt="" /></p>

<h3>Grid Area</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.a{
</span><span class='line'>  grid-column-start: 1;
</span><span class='line'>  grid-column-end: 2; 
</span><span class='line'>  grid-row-start: 1;
</span><span class='line'>  grid-row-end: 2;
</span><span class='line'>}
</span><span class='line'>.a{
</span><span class='line'>  grid-column: 1 / 2; 
</span><span class='line'>  grid-row: 1 / 2;
</span><span class='line'>}
</span><span class='line'>.a{  
</span><span class='line'>  //notice the sequence is row-start/column-start/row-end/column-end
</span><span class='line'>  grid-area: 1 / 1 / 2 / 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>So</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.wrapper {
</span><span class='line'>  display: grid;
</span><span class='line'>  grid-template-columns: 100px 10px 100px 10px 100px 10px 100px;
</span><span class='line'>  grid-template-rows: auto 10px auto 10px auto;
</span><span class='line'>}
</span><span class='line'>.a{
</span><span class='line'>  grid-area: 1 / 1 / 2 / 2;
</span><span class='line'>}
</span><span class='line'>.b {
</span><span class='line'>  grid-area: 1 / 3 / 2 /4;
</span><span class='line'>}
</span><span class='line'>.c { 
</span><span class='line'>  grid-area: 1 / 5 / 2 / 6;
</span><span class='line'>}
</span><span class='line'>.d { 
</span><span class='line'>  grid-area: 1 / 7 / 2 / 8;
</span><span class='line'>}
</span><span class='line'>.e { 
</span><span class='line'>  grid-area: 3 / 1 / 4 / 2;
</span><span class='line'>}
</span><span class='line'>.f {
</span><span class='line'>  grid-area: 3 / 3 / 4 / 4;
</span><span class='line'>}
</span><span class='line'>.g {
</span><span class='line'>  grid-area: 3 / 5 / 4 / 6;
</span><span class='line'>}
</span><span class='line'>.h {
</span><span class='line'>  grid-area: 3 / 7 / 4 / 8;
</span><span class='line'>}
</span><span class='line'>.i {
</span><span class='line'>  grid-area: 5 / 1 / 6 / 2;
</span><span class='line'>}
</span><span class='line'>.j {
</span><span class='line'>  grid-area: 5 / 3 / 6 / 4;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>looks like this</h5>

<p><img src="/myblog/images/image/grid-area.jpg" alt="" /></p>

<h3>Repeat and Span</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//repeat function
</span><span class='line'>grid-template-columns:repeat(6, (col) 100px (gutter) 10px); 
</span><span class='line'>grid-template-rows: repeat(4, (row) auto (gutter) 10px );</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//span merge lines
</span><span class='line'>grid-column: col / span gutter 2; 
</span><span class='line'>grid-row: row;</span></code></pre></td></tr></table></div></figure>


<h3>Grid Template Area</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.sidebar {
</span><span class='line'>    grid-area: sidebar;
</span><span class='line'>}
</span><span class='line'>.sidebar2 {
</span><span class='line'>    grid-area: sidebar2;
</span><span class='line'>}
</span><span class='line'>.content {
</span><span class='line'>    grid-area: content;
</span><span class='line'>}
</span><span class='line'>.header {
</span><span class='line'>    grid-area: header;
</span><span class='line'>}
</span><span class='line'>.footer {
</span><span class='line'>    grid-area: footer;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media only screen and (min-width: 400px) and (max-width: 540px)  {
</span><span class='line'>    .wrapper {
</span><span class='line'>        display: grid;
</span><span class='line'>        grid-template-columns: 20% 5% auto;
</span><span class='line'>        grid-template-rows: auto;
</span><span class='line'>        grid-template-areas: 
</span><span class='line'>      "header header header" 
</span><span class='line'>         "sidebar . content"
</span><span class='line'>         "sidebar2 sidebar2 sidebar2"
</span><span class='line'>         "footer footer footer";
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media only screen and (min-width: 540px) {
</span><span class='line'>    .wrapper {
</span><span class='line'>        display: grid;
</span><span class='line'>        grid-template-columns: 100px 20px auto 20px 100px;
</span><span class='line'>        grid-template-rows: auto;
</span><span class='line'>        grid-template-areas: 
</span><span class='line'>      "header header header header header" 
</span><span class='line'>         "sidebar . content . sidebar2"
</span><span class='line'>         "footer footer footer footer footer";
</span><span class='line'>            max-width: 600px;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/backbone-view-in-view/">Backbone View in View</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-16T14:14:12+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:14 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大 view 里面需要包含一些小view
绑定事件遇到了些问题，不知道能否在小 view inital 或者 render 的时候就能绑定大 view 的事件，
现在的做法是</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//In BigView
</span><span class='line'>new smallview();
</span><span class='line'>smallview.bind('',bigview.function1);
</span><span class='line'>smallview.bind('',bigview.function2);</span></code></pre></td></tr></table></div></figure>


<p>每次 new smallview 的时候都要写绑定事件</p>

<p>目前想在 smallview  initial 或者 render 的时候进行自动绑定
能否在不把 BigView 传入smallView的条件下 实现这样的绑定呢？
不喜欢这样的写法 感觉互相引用总是怪怪的
bigview.a = smallview  smallview.b = bigview</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/promise-part-2/">Promise Part 2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-30T20:12:53+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:12 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myblog/blog/promise-part-1/">Promise Part 1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-18T23:44:16+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:44 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://shangchun.net/promise-insight.html">Read from Here</a></p>

<pre><code>function Promise(fn) {
    var value = null,
        deferreds = [];

    this.then = function (onFulfilled) {
        deferreds.push(onFulfilled);
    };

    function resolve(value) {
        deferreds.forEach(function (deferred) {
            deferred(value);
        });
    }

    fn(resolve);
}
</code></pre>

<p>Promise 做了以下几件事情</p>

<ol>
<li>定义了通过 then 添加回调函数</li>
<li>定义了触发回调执行的 resolve 方法</li>
<li>把2中定义的 resolve 传入 fn 中，并执行 fn，而 fn里面会在特定的时间执行 resolve</li>
</ol>


<p>此外，Promises/A+ 规范明确要求回调需要通过异步方式执行，用以保证一致可靠的执行顺序。为解决这两个问题，可以通过 setTimeout 将 resolve 中执行回调的逻辑放置到 JS 任务队列末尾：</p>

<p>对于 then 的改进</p>

<pre><code>this.then = function (onFulfilled) {
    if (state === 'pending') {
        deferreds.push(onFulfilled);
        return this;
    }
    onFulfilled(value);
    return this;
};
</code></pre>

<p>后续添加的回调也可以立即执行
还是没写完 下次再继续吧</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/myblog/posts/2">&larr; Older</a>
    
    <a href="/myblog/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/myblog/blog/redux/">Redux</a>
      </li>
    
      <li class="post">
        <a href="/myblog/blog/web-socket/">Web Socket</a>
      </li>
    
      <li class="post">
        <a href="/myblog/blog/web-component/">Web Components</a>
      </li>
    
      <li class="post">
        <a href="/myblog/blog/css-grid-layout1/">Talk About Git</a>
      </li>
    
      <li class="post">
        <a href="/myblog/blog/some-standard-events/">Some Standard Events</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Ashley Yang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
